---
layout: post
title: Which are more performant, CTE or temporary tables
categories: [SQL]
description: some word here
keywords: CTE, temporary tables
mermaid: false
sequence: false
flow: false
mathjax: false
mindmap: false
mindmap2: false
---

**CTEs...**

- Are unindexable (but can use existing indexes on referenced objects)
- Cannot have constraints
- Are essentially disposable `VIEW`s
- Persist only until the next query is run
- Can be recursive
- Do not have dedicated stats (rely on stats on the underlying objects)

**Temp Tables...**

- Are real materialized tables that exist in tempdb
- Can be indexed
- Can have constraints
- Persist for the life of the current CONNECTION
- Can be referenced by other queries or subprocedures
- Have dedicated stats generated by the engine

As far as when to use each, they have very different use cases. If you will have a very large result set, or need to refer to it more than once, put it in a `#temp` table. If it needs to be recursive, is disposable, or is just to simplify something logically, a `CTE` is preferred.

**CTE**

```sql
WITH cte (Column1, Column2, Column3)
AS
(
    SELECT Column1, Column2, Column3
    FROM SomeTable
)

SELECT * FROM cte
```

**Temp Table **

```sql
SELECT Column1, Column2, Column3
INTO #tmpTable
FROM SomeTable

SELECT * FROM #tmpTable
```

## Example
CTE
![with-cte](https://xjw-1256033222.cos.ap-guangzhou.myqcloud.com/img/202308231451734.png)

temp table
![temp tbale](https://xjw-1256033222.cos.ap-guangzhou.myqcloud.com/img/%E4%BC%81%E4%B8%9A%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_365c61ca-cffa-435c-be03-a38c36f85c0b.png)
## Refer to or reading

- [x] [What's the difference between a CTE and a Temp Table?](https://dba.stackexchange.com/questions/13112/whats-the-difference-between-a-cte-and-a-temp-table)
- [x] [which-are-more-performant-cte-or-temporary-tables](https://stackoverflow.com/questions/690465/which-are-more-performant-cte-or-temporary-tables)
